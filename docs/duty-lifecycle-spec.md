# üîÅ Nixa Duty | Duty Lifecycle Specification v1.0

## 1. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞

–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –¥–µ–∂—É—Ä—Å—Ç–≤–∞ (Duty) –≤ —Å–∏—Å—Ç–µ–º–µ Nixa Duty –∏ —è–≤–ª—è–µ—Ç—Å—è
–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º –∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—é –¥–ª—è backend- –∏ frontend-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π.

–î–æ–∫—É–º–µ–Ω—Ç —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç:
- –¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–µ–∂—É—Ä—Å—Ç–≤–∞
- –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏
- –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã (side-effects)
- –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

–õ—é–±–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –Ω–µ –æ–ø–∏—Å–∞–Ω–Ω–æ–µ –≤ –¥–∞–Ω–Ω–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ, —Å—á–∏—Ç–∞–µ—Ç—Å—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º.

---

## 2. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–∏ Duty

Duty ‚Äî —ç—Ç–æ –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ duty_schedule, –æ–ø–∏—Å—ã–≤–∞—é—â–∞—è –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–µ –¥–µ–∂—É—Ä—Å—Ç–≤–æ
–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –¥–∞—Ç—É –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø—ã.

Duty —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Å—Ç—Ä–æ–≥–æ –≤ –æ–¥–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –≤ –∫–∞–∂–¥—ã–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏.

---

## 3. –°–ø–∏—Å–æ–∫ —Å–æ—Å—Ç–æ—è–Ω–∏–π (State Enumeration)

–î–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª—è duty_schedule.status:

- pending ‚Äî –¥–µ–∂—É—Ä—Å—Ç–≤–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–æ, –æ–∂–∏–¥–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- done ‚Äî –¥–µ–∂—É—Ä—Å—Ç–≤–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ
- skipped ‚Äî –¥–µ–∂—É—Ä—Å—Ç–≤–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ –ø–æ –ø—Ä–∏—á–∏–Ω–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è
- reassigned ‚Äî –¥–µ–∂—É—Ä—Å—Ç–≤–æ –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–æ —Å–∏—Å—Ç–µ–º–æ–π

---

## 4. State Machine (–ü–µ—Ä–µ—Ö–æ–¥—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π)

–°–æ—Å—Ç–æ—è–Ω–∏—è –∏ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã:

    pending ‚Üí done
    pending ‚Üí skipped
    pending ‚Üí reassigned

–õ—é–±—ã–µ –∏–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –∑–∞–ø—Ä–µ—â–µ–Ω—ã.

---

## 5. –û–ø–∏—Å–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π –∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤

### 5.1 pending

–£—Å–ª–æ–≤–∏—è:
- –¥–∞—Ç–∞ –¥–µ–∂—É—Ä—Å—Ç–≤–∞ —Ä–∞–≤–Ω–∞ –∏–ª–∏ –±–æ–ª—å—à–µ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã
- –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–∫—Ç–∏–≤–µ–Ω (users.is_active = true)

–†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:
- —É—á–∞—Å—Ç–∏–µ –≤ –æ–±–º–µ–Ω–µ (swap)
- –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ
- –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

–ü–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã:
- –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç

---

### 5.2 done

–¢—Ä–∏–≥–≥–µ—Ä:
- –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ—Å—Ç–æ–π —á–µ—Ä–µ–∑ API POST /duty/mark-completed

–ü–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã:
- users.weight —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ 1
- —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ attendance_logs —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º present

–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω–æ
- –æ–±–º–µ–Ω –∑–∞–ø—Ä–µ—â–µ–Ω
- —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω–æ

---

### 5.3 skipped

–¢—Ä–∏–≥–≥–µ—Ä:
- –≤ attendance_logs –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω —Å—Ç–∞—Ç—É—Å absent
- –¥–∞—Ç–∞ –¥–µ–∂—É—Ä—Å—Ç–≤–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ç–µ–∫—É—â–µ–π –¥–∞—Ç–æ–π

–ü–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã:
- –≤–µ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è
- –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤ –æ—á–µ—Ä–µ–¥–∏

–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω–æ
- –æ–±–º–µ–Ω –∑–∞–ø—Ä–µ—â–µ–Ω

---

### 5.4 reassigned

–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è:
- —Ñ–∏–∫—Å–∞—Ü–∏—è —Ñ–∞–∫—Ç–∞ –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –¥–µ–∂—É—Ä—Å—Ç–≤–∞

–¢—Ä–∏–≥–≥–µ—Ä—ã:
- –ø—Ä–∏–Ω—è—Ç—ã–π swap
- –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- —Ä—É—á–Ω–æ–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ Moder –∏–ª–∏ Admin

–ü–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã:
- user_id –≤ duty_schedule –∏–∑–º–µ–Ω—è–µ—Ç—Å—è
- –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–µ–∂—É—Ä—Å—Ç–≤–æ –∏–º–µ–µ—Ç —Å—Ç–∞—Ç—É—Å pending

---

## 6. –°–≤—è–∑—å —Å Attendance

–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤:

- pending ‚Äî attendance –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –≤–µ—Å –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è
- done ‚Äî attendance = present, –≤–µ—Å +1
- skipped ‚Äî attendance = absent, –≤–µ—Å +0

Attendance:
- –≤—Å–µ–≥–¥–∞ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ –¥–∞—Ç–µ
- –Ω–µ –º–æ–∂–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –±–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## 7. –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

- —É –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª–µ–µ –æ–¥–Ω–æ–≥–æ –¥–µ–∂—É—Ä—Å—Ç–≤–∞ –Ω–∞ –æ–¥–Ω—É –¥–∞—Ç—É
- –≤ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª–µ–µ –æ–¥–Ω–æ–≥–æ –¥–µ–∂—É—Ä—Å—Ç–≤–∞ –Ω–∞ –æ–¥–Ω—É –¥–∞—Ç—É
- –¥–µ–∂—É—Ä—Å—Ç–≤–∞ —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏ done –∏ skipped —è–≤–ª—è—é—Ç—Å—è —Ñ–∏–Ω–∞–ª—å–Ω—ã–º–∏
- –æ–±–º–µ–Ω –≤–æ–∑–º–æ–∂–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–µ–∂—É—Ä—Å—Ç–≤ –≤ —Å—Ç–∞—Ç—É—Å–µ pending

–ù–∞—Ä—É—à–µ–Ω–∏–µ –ª—é–±–æ–≥–æ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–∞ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –æ—à–∏–±–∫–µ 422 Unprocessable Entity.

---

## 8. Backend Enforcement

- –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ service-layer
- –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ë–î
- –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è rollback
- frontend –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É

---

## 9. Frontend Contract

Frontend –æ–±—è–∑–∞–Ω:
- –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–µ–∂—É—Ä—Å—Ç–≤–∞ —Å—Ç—Ä–æ–≥–æ –ø–æ status
- –Ω–µ –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏—è, –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ —Ç–µ–∫—É—â–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å backend –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –º—É—Ç–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞

---

## 10. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞

–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —è–≤–ª—è–µ—Ç—Å—è –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –∏—Å—Ç–∏–Ω—ã
–ø–æ –∂–∏–∑–Ω–µ–Ω–Ω–æ–º—É —Ü–∏–∫–ª—É –¥–µ–∂—É—Ä—Å—Ç–≤ –∏ –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ UX- –∏ API-–æ–ø–∏—Å–∞–Ω–∏—è–º–∏
–≤ —Å–ª—É—á–∞–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π.
