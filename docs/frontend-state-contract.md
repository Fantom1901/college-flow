# ⚡ Frontend State Contract Specification v1.0

## 1. Назначение документа

Данный документ описывает **контракт фронтенда с backend** для системы Nixa Duty.  
Он определяет **какие данные приходят с backend**, **как фронтенд должен их отображать** и **какие действия разрешены пользователю**.  

Документ обязателен для frontend-разработки и должен использоваться как **единственный источник правды** для реализации интерфейса.

---

## 2. Основные сущности

### 2.1 Duty (Дежурство)

| Поле     | Тип     | Описание                                   |
|----------|---------|--------------------------------------------|
| id       | integer | Уникальный идентификатор дежурства         |
| date     | string  | Дата в формате `YYYY-MM-DD`                |
| user_id  | integer | ID пользователя, назначенного на дежурство |
| group_id | integer | ID группы, к которой относится дежурство   |
| status   | enum    | pending / done / skipped / reassigned      |

**Frontend должен:**
- Отображать только статус `status` как источник правды.  
- Не предлагать действия, запрещённые текущим статусом:
  - pending — можно подтвердить, предложить swap  
  - done / skipped — действия запрещены  
  - reassigned — отображать нового пользователя, действия запрещены

---

### 2.2 User (Пользователь)

| Поле      | Тип     | Описание                          |
|-----------|---------|-----------------------------------|
| id        | integer | Уникальный идентификатор          |
| tg_id     | integer | Telegram ID                       |
| full_name | string  | ФИО пользователя                  |
| username  | string  | Telegram username                 |
| role      | enum    | superadmin / admin / moder / user |
| weight    | float   | Текущий вес пользователя          |
| is_active | boolean | Активен / деактивирован           |
| group_id  | integer | ID группы                         |

**Frontend должен:**
- Игнорировать пользователей с `is_active = false` в списках дежурств и swap.  
- Отображать роль пользователя и соответствующие разрешения действий.  

---

### 2.3 Swap (Обмен дежурств)

| Поле          | Тип     | Описание                         |
|---------------|---------|----------------------------------|
| id            | integer | Уникальный идентификатор запроса |
| sender_id     | integer | Кто инициировал обмен            |
| receiver_id   | integer | Получатель запроса               |
| sender_date   | string  | Дата дежурства отправителя       |
| receiver_date | string  | Дата дежурства получателя        |
| status        | enum    | pending / accepted / declined    |

**Frontend должен:**
- Показывать только swap для активных пользователей.  
- При статусе `pending` разрешать принятие или отклонение.  
- При `accepted` автоматически обновлять Duty на frontend.  
- При `declined` уведомлять пользователя, что обмен не состоялся.  

---

## 3. JSON-примеры контрактов

### 3.1 Duty

```json
{
  "id": 101,
  "date": "2026-01-20",
  "user_id": 77,
  "group_id": 5,
  "status": "pending"
}
```

### 3.2 User

```json
{
  "id": 77,
  "tg_id": 123456789,
  "full_name": "Аркадий Иванов",
  "username": "arkady",
  "role": "moder",
  "weight": 2,
  "is_active": true,
  "group_id": 5
}
```

### 3.3 Swap

```json
{
  "id": 55,
  "sender_id": 77,
  "receiver_id": 88,
  "sender_date": "2026-01-20",
  "receiver_date": "2026-01-21",
  "status": "pending"
}
```

---

## 4. Инварианты фронтенда

1. **Однозначность отображения Duty:** на одну дату в группе только одно дежурство.
2. **Активность пользователя:** только `is_active = true` участвует во всех списках и действиях.
3. **Синхронизация с backend:** frontend **не вычисляет статус Duty**, а отображает его напрямую из API.
4. **Swap:** действия доступны только для статуса `pending`.

---

## 5. Backend Enforcement

* Все данные должны приходить из backend API без изменения на frontend.
* Любая мутация (подтверждение дежурства, swap) идёт через backend endpoint.
* Frontend может только отображать данные и инициировать разрешённые действия.

---

## 6. Рекомендации

* Использовать **типизацию TypeScript** для всех сущностей (Duty, User, Swap).
* Строго соблюдать статусы и инварианты при разработке компонентов.
* Любое отклонение от этого контракта должно фиксироваться в баг-трекере.

> Этот файл является **необходимым для фронтенда** и должен использоваться совместно с другими спецификациями системы.
